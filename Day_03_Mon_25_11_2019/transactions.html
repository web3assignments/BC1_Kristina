<!DOCTYPE html>
<body>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" 
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" 
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" 
        crossorigin="anonymous">

    <script>
        makeRequests(); // execute first time
        var myVar = setInterval(makeRequests, 10000); // every 10 sec

        async function makeRequests() {
            blockNr = requestBlockNr();
            requestNrTransactions(blockNr);
        }

        async function requestBlockNr(){
            const request=JSON.stringify(
                {"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":67}
            );
            const rawResponse = await fetch('https://mainnet.infura.io', {
                method: 'POST',
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
                },
                body: request
            });
            const content = await rawResponse.json();
            logNr(`${parseInt(content.result)}`);
        }

        function logNr(num) {
            document.getElementById("logNr").innerHTML = num;
        }

        async function requestNrTransactions(){
            const request=JSON.stringify(
                {
                    "id": 1,
                    "method": "eth_getBlockTransactionCountByNumber",
                    "params": ["latest"]
                }
            );
            const rawResponse = await fetch('https://mainnet.infura.io', {
                method: 'POST',
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
                },
                body: request
            });
            const content = await rawResponse.json();
            logTran(`${parseInt(content.result)}`);
        }
    
        function logTran(num) {
            document.getElementById("logTran").innerHTML = num;
        }
        
    </script>

    <br/>
    <div class="card">
        <div class="card-header">
            Number of transactions in the latest block
        </div>
        <div class="card-body">
            <h5 class="card-title">Number of transactions in the latest block</h5>
            <p class="card-text">This webpage allows to track the number of transactions
                 in the latest Ethereum block. The number is displayed below and being 
                 updated every 10 seconds.
            </p>
            <table class="table">
                <tbody>
                        <tr>
                            <th scope="row">Block Nr.</th>
                            <td id="logNr"></td>
                        </tr>
                        <tr>
                            <th scope="row">Transactions Nr.</th>
                            <td id="logTran"></td>
                        </tr>
                </tbody>
            </table>
            <a id="makeRequests" href="#" class="btn btn-primary">Manual refresh</a>
        </div>
    </div>

</body>
